{%- assign v = product.selected_or_first_available_variant -%}
{{ 'main-product-custom.css' |  asset_url |  stylesheet_tag }}
<script src="{{'main-product-custom.js' |  asset_url}}" defer></script>

<section class="pdp" data-pdp>
  <nav class="pdp__crumb" aria-label="Breadcrumb">
    <a href="{{ routes.root_url }}">Home</a>
    <span aria-hidden="true">›</span>
    {%- if product.collections.first -%}
      <a href="{{ product.collections.first.url }}">{{ product.collections.first.title }}</a>
      <span aria-hidden="true">›</span>
    {%- endif -%}
    <span>{{ product.title }}</span>
  </nav>

  <div class="pdp__grid">
    <!-- MEDIA -->
    <div class="pdp__media">
      <div class="pdp__mediaGrid">
        <div class="pdp__pane" data-pane="0"></div>
        <div class="pdp__pane" data-pane="1"></div>
      </div>

      <div class="pdp__thumbs" data-thumbs>
        {%- for m in product.media -%}
          <button class="pdp__thumb" type="button" data-thumb data-media-id="{{ m.id }}" {% if forloop.first %}aria-current="true"{% endif %}>
            {%- if m.preview_image -%}
              <img
                src="{{ m.preview_image | image_url: width: 160 }}"
                alt="{{ m.alt | escape }}"
                loading="lazy"
                width="56"
                height="56"
              >
            {%- endif -%}
          </button>
        {%- endfor -%}
      </div>
    </div>

    <!-- RIGHT -->
    <aside class="pdp__right">
      <div class="pdp__vendor">{{ product.vendor }}</div>
      <h1 class="pdp__title">{{ product.title }}</h1>

      <div class="pdp__rating">
        <span class="pdp__stars" aria-hidden="true">★★★★★</span>
        <span>(0)</span>
      </div>

      <div class="pdp__priceRow">
        <span class="pdp__price" data-price>{{ v.price | money }}</span>

        {%- if v.compare_at_price and v.compare_at_price > v.price -%}
          <span class="pdp__compare" data-compare>{{ v.compare_at_price | money }}</span>
          {%- assign off = v.compare_at_price | minus: v.price | times: 100 | divided_by: v.compare_at_price -%}
          <span class="pdp__badge">-{{ off | round }}%</span>
        {%- endif -%}
      </div>

      <div class="pdp__desc">
        {{ product.description | strip_html | truncate: 260 }}
      </div>

      <div class="pdp__tiles">
        <div class="pdp__tile" title="Soy free">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" aria-hidden="true">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M8 8l8 8M16 8l-8 8"></path>
          </svg>
        </div>
        <div class="pdp__tile"></div>
        <div class="pdp__tile"></div>
      </div>

      <div class="pdp__bundle" id="bundle">
        <div aria-hidden="true" class="pdp__bundleIcon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <path d="M12 2l8 4v6c0 5-3.4 9.4-8 10-4.6-.6-8-5-8-10V6l8-4z"></path>
            <path d="M8.5 12l2.2 2.2 4.8-5"></path>
          </svg>
        </div>
        <div>
            {% if section.settings.bundle_note != blank and section.settings.bundle_title != blank %}
                <div><strong>{{section.settings.bundle_title}} <em>{{section.settings.bundle_note}}</em></strong></div>
            {% else %}
                <div><strong>BUNDLE &amp; SAVE <em>(20% off + free gift)</em></strong></div>
            {% endif %}

            {% if section.settings.bundle_desc != blank %}
                <div class="pdp__bundleText">{{section.settings.bundle_desc}}</div>
            {% else %}
                <div class="pdp__bundleText">Change your flavour selection any time, keep breakfast exciting!</div>
            {% endif %}


             {% if section.settings.bundle_me != blank %}
                 <a class="pdp__bundleLink" href="#bundle">{{section.settings.bundle_me}}</a>
            {% else %}
                 <a class="pdp__bundleLink" href="#bundle">Build my bundle</a>
            {% endif %}
        </div>
      </div>

      <div class="pdp__bullets">
        <div class="pdp__bullet">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <path d="M3 7h14l4 4v6H3z"></path><path d="M7 7V3h6v4"></path><path d="M7 17h.01"></path>
          </svg>
            {% if section.settings.bullet_1 != blank %}
                 <div>Delivered to {{ localization.country.name | default: 'your location' }}, {{ 'now' | date: "%b %d" }} + {{section.settings.bullet_1}}</div>
            {% else %}
                 <div>Delivered to {{ localization.country.name | default: 'your location' }}, {{ 'now' | date: "%b %d" }} + 7 days</div>
            {% endif %}
        </div>
        <div class="pdp__bullet">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <path d="M12 1v22"></path><path d="M17 6H9.5a3.5 3.5 0 0 0 0 7H15a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
            {% if section.settings.bullet_2 != blank %}
                 <div>{{section.settings.bullet_2}}</div>
            {% else %}
                 <div>As low as $142/month. Affirm financing</div>
            {% endif %}

        </div>
        <div class="pdp__bullet">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <path d="M21 12a9 9 0 1 1-9-9"></path><path d="M21 3v6h-6"></path>
          </svg>
            {% if section.settings.bullet_3 != blank %}
                 <div>{{section.settings.bullet_3}}</div>
            {% else %}
                    <div>30 days satisfaction guarantee</div>
            {% endif %}
          <div>30 days satisfaction guarantee</div>
        </div>
      </div>

      <div class="pdp__stock">
        <span class="pdp__dot"></span>
        <span>{% if v.available %}In stock{% else %}Out of stock{% endif %}</span>
      </div>

      {% form 'product', product, class: 'pdp__form', data-product-form: '' %}
        <input type="hidden" name="id" value="{{ v.id }}" data-variant-id>

        {%- if product.variants.size > 1 -%}
          <label class="pdp__label">Variant</label>
          <select class="pdp__select" name="id" data-variant-select>
            {%- for variant in product.variants -%}
              <option value="{{ variant.id }}" {% if variant.id == v.id %}selected{% endif %} {% unless variant.available %}disabled{% endunless %}>
                {{ variant.title }}{% unless variant.available %} — Sold out{% endunless %}
              </option>
            {%- endfor -%}
          </select>
        {%- endif -%}

        <div class="pdp__atcRow">
          <div class="pdp__qty">
            <button type="button" data-qty-dec aria-label="Decrease">−</button>
            <input type="number" name="quantity" value="1" min="1" data-qty>
            <button type="button" data-qty-inc aria-label="Increase">+</button>
          </div>

          <button class="pdp__atc" type="submit" {% unless v.available %}disabled{% endunless %}>
            Add to cart
          </button>

          <button class="pdp__iconBtn" type="button" aria-label="Share">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6">
              <path d="M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7"></path>
              <path d="M16 6l-4-4-4 4"></path>
              <path d="M12 2v14"></path>
            </svg>
          </button>
        </div>

        <button class="pdp__buyNow" type="button" data-buy-now {% unless v.available %}disabled{% endunless %}>
          Buy it now
        </button>
      {% endform %}

      <div class="pdp__pay">
        <h4>Pay with</h4>
        <div class="pdp__payRow">{{ shop.enabled_payment_types | payment_type_svg_tag }}</div>
        <p>Your transaction is protected with advanced security measures to keep your information confidential</p>
      </div>
    </aside>
  </div>

  <!-- LOWER -->
  <div class="pdp__lower">
    <div>
      <h2 class="pdp__h2">About this item</h2>

      <div class="pdp__h3">Highlights</div>
      <ul class="pdp__list">
        <li>Maximize chocolate chip cookies</li>
        <li>Ready to eat</li>
        <li>Great tasting cookies at a value</li>
        <li>An easy treat everyone will love</li>
        <li>10ct</li>
      </ul>

      <div class="pdp__h3">Description</div>
      <div class="pdp__descLong">
        {{ product.description }}
      </div>

      {%- assign pdp_image = product.metafields.custom.pdp_image -%}
      {%- if pdp_image != blank -%}
        <div class="pdp__bigImage">
          <img src="{{ pdp_image | image_url: width: 1600 }}" alt="{{ product.title | escape }}" loading="lazy" height="auto" width="1600">
        </div>
      {%- endif -%}

      <h2 class="pdp__h2" style="margin-top:26px;">Product information</h2>
      <table class="pdp__table">
        <tr><th>Brand</th><td>{{ product.vendor }}</td></tr>
        <tr><th>Freshness guarantee</th><td>Keeps for at least 1 day(s) after receipt</td></tr>
        <tr><th>Country of production</th><td>{{ localization.country.name | default: '—' }}</td></tr>
        <tr>
          <th>Ingredients</th>
          <td>
            {% if product.metafields.custom.ingredients and product.metafields.custom.ingredients != blank %}
              {{ product.metafields.custom.ingredients }}
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
        <tr><th>Diet</th><td>{{ product.metafields.custom.diet | default: '—' }}</td></tr>
        <tr><th>Article number</th><td>{{ product.id }}</td></tr>
        <tr><th>Miscellaneous</th><td>{{ product.metafields.custom.misc | default: 'Product has been part-baked in a stone oven, frozen and finished in store.' }}</td></tr>
        <tr><th>Certification body</th><td>{{ product.metafields.custom.certification_body | default: '—' }}</td></tr>
      </table>

      <div class="pdp__ctaStrip">
        Can't wait for your bars to arrive? <a href="#">More</a>
      </div>
    </div>

    <div class="pdp__acc">
      <details open>
        <summary>Nutrition information <span aria-hidden="true">▾</span></summary>
        <div class="pdp__accBody">
          {%- if product.metafields.custom.nutrition_html != blank -%}
            {{ product.metafields.custom.nutrition_html }}
          {%- else -%}
            <div class="pdp__nutritionBox">
              <div class="pdp__nutritionTitle">Nutritional values per: 100g | 1 portion (75g)</div>
              <table class="pdp__table pdp__table--tight">
                <tr><th>Energy</th><td>ca. 1323</td></tr>
                <tr><th>Energy</th><td>ca. 313</td></tr>
                <tr><th>Fat</th><td>ca. 12g</td></tr>
                <tr><th>&nbsp;&nbsp;saturated fatty acids</th><td>ca. 1g</td></tr>
                <tr><th>Carbohydrate</th><td>ca. 39</td></tr>
                <tr><th>&nbsp;&nbsp;of which sugars</th><td>ca. 1.5g</td></tr>
                <tr><th>Dietary fiber</th><td>ca. 5.7g</td></tr>
                <tr><th>Protein</th><td>ca. 10g</td></tr>
                <tr><th>Salt</th><td>ca. 1.2g</td></tr>
              </table>
            </div>
          {%- endif -%}
        </div>
      </details>

      <details>
        <summary>Ingredients &amp; Nutrition <span aria-hidden="true">▾</span></summary>
        <div class="pdp__accBody">
          {{ product.metafields.custom.ingredients | default: '—' }}
        </div>
      </details>

      <details>
        <summary>Shipping and Returns <span aria-hidden="true">▾</span></summary>
        <div class="pdp__accBody">
          {%- if shop.shipping_policy.body != blank -%}
            {{ shop.shipping_policy.body }}
          {%- else -%}
            Standard shipping in 3–7 business days. Returns accepted within 30 days.
          {%- endif -%}
        </div>
      </details>
    </div>
  </div>

  <div class="pdp__coupon" data-coupon>
    <div><strong>You've got 25% off</strong></div>
    <button type="button" data-coupon-close aria-label="Close">×</button>
  </div>

  <!-- JSON for gallery + variants -->
  <script type="application/json" data-media-json>
    [
      {%- for m in product.media -%}
        {
          "id": {{ m.id | json }},
          "type": {{ m.media_type | json }},
          "alt": {{ m.alt | default: '' | json }},
          "preview": {{ m.preview_image | image_url: width: 900 | json }},
          "full": {%- if m.media_type == 'image' -%}{{ m | image_url: width: 1600 | json }}{%- else -%}{{ m.preview_image | image_url: width: 1600 | json }}{%- endif -%}
        }{% unless forloop.last %},{% endunless %}
      {%- endfor -%}
    ]
  </script>

  <script type="application/json" data-variants-json>
    {{ product.variants | json }}
  </script>
</section>




{% schema %}
{
  "name": "Main product custom",
  "settings": [
    { "type": "text", "id": "bundle_title", "label": "Bundle title", "default": "BUNDLE & SAVE" },
    { "type": "text", "id": "bundle_note", "label": "Bundle note", "default": "(20% off + free gift)" },
    { "type": "text", "id": "bundle_me", "label": "Build my bundle", "default": "Build my bundle" },
    { "type": "textarea", "id": "bundle_desc", "label": "Bundle description", "default": "Change your flavour selection any time, keep breakfast exciting!" },

    { "type": "text", "id": "bullet_1", "label": "Bullet 1", "default": "3 days" },
    { "type": "text", "id": "bullet_2", "label": "Bullet 2", "default": "Financing available" },
    { "type": "text", "id": "bullet_3", "label": "Bullet 3", "default": "30 days satisfaction guarantee" }
  ]
}
{% endschema %}