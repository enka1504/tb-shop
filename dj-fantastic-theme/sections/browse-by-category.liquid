{% comment %} 
          Browse by category (responsive) 
          - Desktop: grid/row 
          - Mobile: horizontal swipe with snap 
{% endcomment %}

<section
  class="bbc"
  data-section-id="{{ section.id }}"
  style="
    --bbc-title-size: {{ section.settings.title_size }}px;
    --bbc-gap: {{ section.settings.gap }}px;
    --bbc-card-w: {{ section.settings.card_width }}px;
    --bbc-card-h: {{ section.settings.card_height }}px;
    --bbc-radius: {{ section.settings.radius }}px;
    --bbc-img-size: {{ section.settings.image_size }}px;
    --bbc-pad-x: {{ section.settings.page_padding }}px;
  ">
  <div class="bbc__wrap">
    {% if section.settings.heading != blank %}
      <h2 class="bbc__title">{{ section.settings.heading | escape }}</h2>
    {% endif %}

    <div
      class="bbc__scroller"
      role="list"
      aria-label="{{ section.settings.heading | escape }}">
      {% for block in section.blocks %}
        {% if block.type == 'category' %}
          {% assign bg = block.settings.bg_color %}
          <a
            class="bbc__item"
            href="{{ block.settings.link | default: '#' }}"
            role="listitem"
            {{ block.shopify_attributes }}
            style="--bbc-bg: {{ bg }};">
            <div class="bbc__card" aria-hidden="true">
              {% if block.settings.image != blank %}
                {{ block.settings.image
 | image_url: width: 400
 | image_tag:
 loading: 'lazy',
 class: 'bbc__img',
 alt: block.settings.label
                }}
              {% else %}
                <div class="bbc__img bbc__img--ph"></div>
              {% endif %}
            </div>

            {% if block.settings.label != blank %}
              <div class="bbc__label">{{ block.settings.label | escape }}</div>
            {% endif %}
          </a>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <style>
    .bbc {
      width: 100%;
      padding: 20px 0;
    }
    .bbc__wrap {
      max-width: {{ section.settings.max_width }}px;
      margin: 0 auto;
      padding: 0 var(--bbc-pad-x);
    }

    .bbc__title {
      text-align: center;
      font-size: var(--bbc-title-size);
      line-height: 1.2;
      font-weight: 700;
      margin: 0 0 18px;

    }

    /* Desktop layout */
    .bbc__scroller {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--bbc-gap);
      align-items: start;
    }

    .bbc__item {
      text-decoration: none;
      color: inherit;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      outline: none;
    }

    .bbc__card {
      width: var(--bbc-card-w);
      height: var(--bbc-card-h);
      border-radius: var(--bbc-radius);
      background: var(--bbc-bg, #e9eef6);
      display: grid;
      place-items: center;
      overflow: hidden;
      transition: transform 0.18s ease
      , box-shadow 0.18s ease;
    }

    .bbc__img {
      width: var(--bbc-img-size);
      height: var(--bbc-img-size);
      object-fit: cover;
      border-radius: 10px;
      display: block;
      transform: translateZ(0);
    }

    .bbc__img--ph {
      background: rgba(0, 0, 0, 0.06);
      border-radius: 14px;
    }

    .bbc__label {
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      opacity: .95;
    }

    .bbc__item:hover .bbc__card {
      transform: translateY(-2px);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.08);
    }

    .bbc__item:focus-visible .bbc__card {
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.22);
    }

    /* Mobile: swipe row like your screenshot */
    @media (max-width: 749px) {
      .bbc__wrap {
        padding: 0 16px;
      }
      .bbc__title {
        margin-bottom: 14px;
      }

      .bbc__scroller {
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: minmax(110px, 1fr);
        overflow-x: auto;
        overflow-y: hidden;
        gap: 14px;
        padding-bottom: 10px;

        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      .bbc__scroller::-webkit-scrollbar {
        display: none;
      }

      .bbc__item {
        scroll-snap-align: start;
      }
      .bbc__card {
        width: 110px;
        height: 86px;
      }
      .bbc__img {
        width: 58px;
        height: 58px;
      }
      .bbc__label {
        font-size: 13px;
      }
    }
  </style>
</section>

{% schema %}
  {
    "name": "Browse by category",
    "disabled_on": {
      "groups": ["header", "footer"]
    },
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Browse by category"
      },

      {
        "type": "range",
        "id": "title_size",
        "min": 10,
        "max": 30,
        "step": 1,
        "label": "Title size",
        "default": 22
      },

      {
        "type": "range",
        "id": "max_width",
        "min": 900,
        "max": 1600,
        "step": 50,
        "label": "Max width",
        "default": 1400
      },
      {
        "type": "range",
        "id": "page_padding",
        "min": 0,
        "max": 60,
        "step": 2,
        "label": "Side padding (desktop)",
        "default": 24
      }, {
        "type": "range",
        "id": "gap",
        "min": 8,
        "max": 40,
        "step": 1,
        "label": "Gap",
        "default": 22
      }, {
        "type": "range",
        "id": "card_width",
        "min": 90,
        "max": 220,
        "step": 2,
        "label": "Card width (desktop)",
        "default": 140
      }, {
        "type": "range",
        "id": "card_height",
        "min": 70,
        "max": 180,
        "step": 2,
        "label": "Card height (desktop)",
        "default": 100
      }, {
        "type": "range",
        "id": "image_size",
        "min": 40,
        "max": 140,
        "step": 2,
        "label": "Image size (desktop)",
        "default": 78
      }, {
        "type": "range",
        "id": "radius",
        "min": 8,
        "max": 40,
        "step": 1,
        "label": "Corner radius",
        "default": 18
      }
    ],
    "blocks": [
      {
        "type": "category",
        "name": "Category",
        "settings": [
          {
            "type": "text",
            "id": "label",
            "label": "Label",
            "default": "Vegetables"
          }, {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          }, {
            "type": "url",
            "id": "link",
            "label": "Link"
          }, {
            "type": "color",
            "id": "bg_color",
            "label": "Background color",
            "default": "#dfeaf6"
          }
        ]
      }
    ],
    "max_blocks": 20,
    "presets": [
      {
        "name": "Browse by category",
        "blocks": [
          {
            "type": "category"
          },
          {
            "type": "category"
          },
          {
            "type": "category"
          },
          {
            "type": "category"
          }, {
            "type": "category"
          }, {
            "type": "category"
          }
        ]
      }
    ]
  }
{% endschema %}