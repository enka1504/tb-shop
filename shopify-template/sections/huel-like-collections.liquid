{% comment %}
  Huel-like sidebar + horizontal card slider (scroll + snap + arrows)
  File: sections/huel-like-collections.liquid
{% endcomment %}

<section id="huel-like-{{ section.id }}" class="huel-like">
  <div class="huel-like__wrap huel-container">

    <!-- Sidebar -->
    <aside class="huel-like__sidebar">
      {% if section.settings.sidebar_title != blank %}
        <h3 class="huel-like__side-title">{{ section.settings.sidebar_title }}</h3>
      {% endif %}

      <div class="huel-like__side-links">
        {% for block in section.blocks %}
          {% if block.type == 'sidebar_link' %}
            <a class="huel-like__side-link" href="{{ block.settings.url | default: '#' }}">
              {{ block.settings.label }}
            </a>
          {% endif %}
        {% endfor %}
      </div>

      {% if section.settings.sidebar_cta_label != blank %}
        <a class="huel-like__side-cta" href="{{ section.settings.sidebar_cta_url | default: '#' }}">
          {{ section.settings.sidebar_cta_label }}
        </a>
      {% endif %}

      {% if section.settings.sidebar_primary_label != blank %}
        <a class="huel-like__side-primary" href="{{ section.settings.sidebar_primary_url | default: '#' }}">
          {{ section.settings.sidebar_primary_label }}
        </a>
      {% endif %}
    </aside>

    <!-- Cards Slider -->
    <div class="huel-like__cards">
      <div class="huel-like__slider">
        <!-- Left arrow -->
        <button type="button" class="huel-like__arrow huel-like__arrow--left" aria-label="Scroll left">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <!-- Scroll area -->
        <div class="huel-like__scroller" data-scroller>
          {% for block in section.blocks %}
            {% if block.type == 'card' %}
              {% assign img = block.settings.image %}
              <a class="huel-like__card" href="{{ block.settings.url | default: '#' }}" {{ block.shopify_attributes }}>
                <div class="huel-like__card-media"
                  style="{% if img != blank %}background-image:url('{{ img | image_url: width: 1400 }}');{% endif %}">
                  <div class="huel-like__card-overlay"></div>

                  <div class="huel-like__card-content">
                    <div class="huel-like__card-title">{{ block.settings.title }}</div>

                    <div class="huel-like__card-arrow" aria-hidden="true">
                      <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>

                </div>
              </a>
            {% endif %}
          {% endfor %}
        </div>

        <!-- Right arrow -->
        <button type="button" class="huel-like__arrow huel-like__arrow--right" aria-label="Scroll right">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

  </div>

  <style>
    /* container */
    #huel-like-{{ section.id }} .huel-container{
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    #huel-like-{{ section.id }}.huel-like{
      background:#fff;
      padding:18px 0;
    }

    #huel-like-{{ section.id }} .huel-like__wrap{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap: 22px;
      align-items:start;
    }

    /* sidebar */
    #huel-like-{{ section.id }} .huel-like__sidebar{
      background:#f3f0ea;
      border-radius:14px;
      padding:18px 16px;
    }
    #huel-like-{{ section.id }} .huel-like__side-title{
      font-size:14px;
      font-weight:800;
      margin:0 0 12px;
      color:#111;
    }
    #huel-like-{{ section.id }} .huel-like__side-links{
      display:grid;
      gap:10px;
      margin-bottom:14px;
    }
    #huel-like-{{ section.id }} .huel-like__side-link{
      display:block;
      padding:10px 12px;
      border-radius:10px;
      background:rgba(255,255,255,0.55);
      color:#111;
      text-decoration:none;
      font-size:13px;
      font-weight:700;
      border:1px solid rgba(0,0,0,0.05);
    }
    #huel-like-{{ section.id }} .huel-like__side-link:hover{ background:rgba(255,255,255,0.85); }

    #huel-like-{{ section.id }} .huel-like__side-cta{
      display:inline-flex;
      justify-content:center;
      width:100%;
      padding:10px 14px;
      border-radius:999px;
      background:#e8f7e8;
      border:1px solid rgba(0,0,0,0.08);
      color:#111;
      text-decoration:none;
      font-size:12px;
      font-weight:800;
      margin-bottom:12px;
    }
    #huel-like-{{ section.id }} .huel-like__side-primary{
      display:inline-flex;
      justify-content:center;
      width:100%;
      padding:10px 14px;
      border-radius:999px;
      background:#111;
      color:#fff;
      text-decoration:none;
      font-size:12px;
      font-weight:900;
    }

    /* slider wrapper */
    #huel-like-{{ section.id }} .huel-like__slider{
      position:relative;
      display:flex;
      align-items:center;
      gap:10px;
    }

    /* scroll container */
    #huel-like-{{ section.id }} .huel-like__scroller{
      display:flex;
      gap:18px;
      overflow-x:auto;
      padding:2px 6px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      width:100%;
    }
    #huel-like-{{ section.id }} .huel-like__scroller::-webkit-scrollbar{ display:none; }

    /* cards as snap items */
    #huel-like-{{ section.id }} .huel-like__card{
      scroll-snap-align: start;
      flex: 0 0 320px;
      text-decoration:none;
      color:inherit;
      display:block;
    }

    #huel-like-{{ section.id }} .huel-like__card-media{
      position:relative;
      height:176px;
      border-radius:14px;
      background:#ddd;
      background-size:cover;
      background-position:center;
      overflow:hidden;
      border:1px solid rgba(0,0,0,0.06);
      transition: transform .2s ease;
    }
    #huel-like-{{ section.id }} .huel-like__card:hover .huel-like__card-media{
      transform: translateY(-1px);
    }

    #huel-like-{{ section.id }} .huel-like__card-overlay{
      position:absolute; inset:0;
      background: linear-gradient(0deg, rgba(0,0,0,0.22), rgba(0,0,0,0.10));
    }

    #huel-like-{{ section.id }} .huel-like__card-content{
      position:absolute; inset:0;
      padding:16px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
    }
    #huel-like-{{ section.id }} .huel-like__card-title{
      font-size:14px;
      font-weight:900;
      color:#fff;
      text-shadow:0 1px 10px rgba(0,0,0,0.25);
    }
    #huel-like-{{ section.id }} .huel-like__card-arrow{
      width:36px; height:36px;
      border-radius:999px;
      background: rgba(255,255,255,0.92);
      color:#111;
      display:grid;
      place-items:center;
      box-shadow:0 6px 16px rgba(0,0,0,0.14);
      align-self:flex-end;
      margin-top:auto;
    }

    /* arrows */
    #huel-like-{{ section.id }} .huel-like__arrow{
      width:40px; height:40px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(0,0,0,0.10);
      box-shadow:0 10px 24px rgba(0,0,0,0.10);
      color:#111;
      display:grid;
      place-items:center;
      cursor:pointer;
      flex: 0 0 auto;
    }
    #huel-like-{{ section.id }} .huel-like__arrow:hover{ background: #f7f7f7; }
    #huel-like-{{ section.id }} .huel-like__arrow[disabled]{ opacity:0.35; cursor:not-allowed; box-shadow:none; }

    /* responsive */
    @media (max-width: 1024px){
      #huel-like-{{ section.id }} .huel-like__wrap{ grid-template-columns: 1fr; }
      #huel-like-{{ section.id }} .huel-like__card{ flex-basis: 300px; }
    }
    @media (max-width: 560px){
      #huel-like-{{ section.id }} .huel-like__card{ flex-basis: 260px; }
      #huel-like-{{ section.id }} .huel-like__arrow{ display:none; } /* swipe on mobile */
    }
  </style>

  <script>
    (function() {
      var root = document.getElementById('huel-like-{{ section.id }}');
      if (!root) return;

      var scroller = root.querySelector('[data-scroller]');
      var leftBtn = root.querySelector('.huel-like__arrow--left');
      var rightBtn = root.querySelector('.huel-like__arrow--right');
      if (!scroller || !leftBtn || !rightBtn) return;

      function getStep() {
        // scroll by ~1 card width (card + gap)
        var card = scroller.querySelector('.huel-like__card');
        if (!card) return 320;
        var styles = window.getComputedStyle(scroller);
        var gap = parseInt(styles.columnGap || styles.gap || "18", 10) || 18;
        return card.getBoundingClientRect().width + gap;
      }

      function updateButtons() {
        var maxScrollLeft = scroller.scrollWidth - scroller.clientWidth - 2;
        leftBtn.disabled = scroller.scrollLeft <= 1;
        rightBtn.disabled = scroller.scrollLeft >= maxScrollLeft;
      }

      leftBtn.addEventListener('click', function() {
        scroller.scrollBy({ left: -getStep(), behavior: 'smooth' });
      });

      rightBtn.addEventListener('click', function() {
        scroller.scrollBy({ left: getStep(), behavior: 'smooth' });
      });

      scroller.addEventListener('scroll', function() {
        window.requestAnimationFrame(updateButtons);
      });

      window.addEventListener('resize', updateButtons);

      // initial
      updateButtons();
    })();
  </script>
</section>

{% schema %}
{
  "name": "Huel-like sidebar slider",
  "settings": [
    { "type": "text", "id": "sidebar_title", "label": "Sidebar title", "default": "Shop by Collection" },
    { "type": "text", "id": "sidebar_cta_label", "label": "Sidebar CTA label", "default": "Shop outlet & save" },
    { "type": "url", "id": "sidebar_cta_url", "label": "Sidebar CTA link" },
    { "type": "text", "id": "sidebar_primary_label", "label": "Sidebar primary button label", "default": "Shop all" },
    { "type": "url", "id": "sidebar_primary_url", "label": "Sidebar primary button link" }
  ],
  "blocks": [
    {
      "type": "sidebar_link",
      "name": "Sidebar link",
      "settings": [
        { "type": "text", "id": "label", "label": "Label", "default": "Shop by Goal" },
        { "type": "url", "id": "url", "label": "Link" }
      ]
    },
    {
      "type": "card",
      "name": "Card",
      "settings": [
        { "type": "text", "id": "title", "label": "Title", "default": "Lose weight" },
        { "type": "image_picker", "id": "image", "label": "Background image" },
        { "type": "url", "id": "url", "label": "Link" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Huel-like sidebar slider",
      "blocks": [
        { "type": "sidebar_link", "settings": { "label": "Shop by Collection" } },
        { "type": "sidebar_link", "settings": { "label": "Shop by Goal" } },
        { "type": "sidebar_link", "settings": { "label": "Help me choose" } },

        { "type": "card", "settings": { "title": "Lose weight" } },
        { "type": "card", "settings": { "title": "More protein" } },
        { "type": "card", "settings": { "title": "Eat healthy" } },
        { "type": "card", "settings": { "title": "On-the-go" } }
      ]
    }
  ]
}
{% endschema %}